# üõ°Ô∏è Reglas Estrictas para Cursor/Codex - iURi

## ‚ùå PROHIBIDO (bloqueo autom√°tico)

1. **NO borrar/renombrar** `src/components/marine/*`
2. **NO introducir** `react-leaflet` (usar MapLibre GL JS o Leaflet directo)
3. **NO usar** WebSocket `:8000` sin gate de `VITE_USE_IURI_WS`
4. **NO cambiar nombres** de envs cr√≠ticas:
   - `VITE_SIGNALK_WS`
   - `VITE_MQTT_WS`
   - `VITE_VESSEL_ID`
5. **NO tocar** archivos protegidos salvo que sea el objetivo del PR:
   - `src/router*`
   - `src/layouts/`
   - `src/components/Sidebar*`
   - `src/pages/`

## ‚úÖ ANTES DE MERGEAR (obligatorio)

1. Ejecutar `frontend/scripts/premerge_guard.sh`
2. Ejecutar `frontend/scripts/llm_diff_review.sh` (Ollama local)
3. Adjuntar salida de ambos en descripci√≥n del PR
4. Si hay cambios en marine/: ejecutar `frontend/scripts/sanity_stack.sh`
5. Capturas de pantalla del m√≥dulo afectado

## üìã COMMITS AT√ìMICOS

- 1 objetivo por PR (ejemplos v√°lidos):
  - ‚úÖ `feat(marine): add wind widget`
  - ‚úÖ `fix(i18n): sync missing keys pt/es`
  - ‚úÖ `chore(marine): gate WS behind VITE_USE_IURI_WS`

- Ejemplos **NO** v√°lidos (muy amplios):
  - ‚ùå `feat: marine panel + i18n + lazy load + fixes`
  - ‚ùå `refactor: everything`

## üß† USO DE IA LOCAL (Ollama)

Antes de proponer c√≥digo que toque:
- `src/components/marine/`
- `src/hooks/use*Marine*`
- `src/hooks/useSignalK.ts`
- `src/hooks/useMQTT.ts`
- `docker-compose.marine.yml`

**EJECUTAR:**
```bash
cd frontend
MODEL=llama3.2 bash scripts/llm_diff_review.sh
```

Y **ADJUNTAR** la salida al mensaje/PR.

## üìö DOCUMENTACI√ìN DE REFERENCIA

- `gateway/README.md` ‚Üí Stack marino completo
- `.env.example` ‚Üí Variables obligatorias
- `ARQUITECTURA_COMPLETA_IURI.md` ‚Üí Visi√≥n del sistema

## üö® SI ALGO SE ROMPE

1. **NO hacer push** si `/dashboard` no carga
2. **Verificar** que no tocaste archivos prohibidos:
   ```bash
   git diff --name-only origin/main | grep -E '^(frontend/src/router|frontend/src/layouts|frontend/src/components/Sidebar|frontend/src/pages/)'
   ```
3. Si tocaste archivos prohibidos, **revertir**:
   ```bash
   git restore frontend/src/router* frontend/src/layouts/ frontend/src/components/Sidebar* frontend/src/pages/
   ```

---

**√öltima actualizaci√≥n:** 30 Octubre 2025
**Versi√≥n:** 2.0 (con guardi√°n IA local)
