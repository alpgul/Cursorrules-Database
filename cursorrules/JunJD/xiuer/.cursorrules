# å°çº¢ä¹¦æ•°æ®åˆ†æå¹³å° - Cursor Rules

You are an expert full-stack developer proficient in **Python 3.12**, **FastAPI**, **Next.js 14**, **TypeScript**, **PostgreSQL**, **Docker**, and modern web development best practices.

æ¯æ¬¡ä½ é€‰æ‹©å¼•ç”¨æŸæ¡è§„åˆ™ï¼Œè¯·åœ¨è¾“å‡ºä¸­æ˜¾å¼å†™å‡ºè¯¥è§„åˆ™ï¼ˆå¯ä½¿ç”¨ç¼©å†™ï¼‰ã€‚

## ğŸ¯ Core Expertise
- Backend: FastAPI + AsyncSQLAlchemy + Pydantic v2 + Alembic
- Frontend: Next.js 14 (App Router) + TypeScript + Tailwind CSS + React Query + Zustand
- Database: PostgreSQL + Redis (caching)
- DevOps: Docker + GitHub Actions + MkDocs
- Crawler: Python + PyExecJS + Loguru
- Testing: pytest + Jest + React Testing Library

## ğŸ“ Monorepo Structure

```
project_root/
â”œâ”€â”€ fastapi_backend/         # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½® (config, database, logger)
â”‚   â”‚   â”œâ”€â”€ models.py       # SQLAlchemy ORM æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/        # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ routes/         # API è·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ main.py         # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ tests/              # åç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ alembic/            # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ pyproject.toml
â”œâ”€â”€ nextjs-frontend/         # Next.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app/                # App Router é¡µé¢
â”‚   â”œâ”€â”€ components/         # UI ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“å’Œ hooks
â”‚   â””â”€â”€ __tests__/          # å‰ç«¯æµ‹è¯•
â”œâ”€â”€ Spider_XHS/              # å°çº¢ä¹¦çˆ¬è™«ç³»ç»Ÿ
â”‚   â”œâ”€â”€ apis/               # API æ¥å£å°è£…
â”‚   â”œâ”€â”€ xhs_utils/          # çˆ¬è™«å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ src/                # æ ¸å¿ƒçˆ¬è™«ä»£ç 
â”‚   â”œâ”€â”€ main.py             # çˆ¬è™«å…¥å£
â”‚   â””â”€â”€ pyproject.toml
â”œâ”€â”€ docs/                   # MkDocs æ–‡æ¡£
â”œâ”€â”€ mdc-examples/           # MDC ç»„ä»¶ç¤ºä¾‹
â”œâ”€â”€ .github/workflows/      # GitHub Actions
â”œâ”€â”€ docker-compose.yml      # å¼€å‘ç¯å¢ƒ
â””â”€â”€ mkdocs.yml             # æ–‡æ¡£é…ç½®
```

## ğŸ—ï¸ Architecture Principles

### Backend (FastAPI)
- **åˆ†å±‚æ¶æ„**: Routes â†’ Services â†’ Models
- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ FastAPI çš„ Dependency Injection
- **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨ AsyncSession
- **ç±»å‹å®‰å…¨**: ä¸¥æ ¼çš„ Pydantic æ•°æ®éªŒè¯
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„ HTTPException å¤„ç†

### Frontend (Next.js)
- **App Router**: ä½¿ç”¨ Next.js 14 æœ€æ–°è·¯ç”±ç³»ç»Ÿ
- **æœåŠ¡ç«¯ç»„ä»¶**: ä¼˜å…ˆä½¿ç”¨ RSCï¼Œå¿…è¦æ—¶æ‰ç”¨å®¢æˆ·ç«¯ç»„ä»¶
- **ç±»å‹å®‰å…¨**: TypeScript strict mode + Zod éªŒè¯
- **çŠ¶æ€ç®¡ç†**: Zustand (å…¨å±€) + React Query (æœåŠ¡ç«¯çŠ¶æ€)
- **æ ·å¼ç³»ç»Ÿ**: Tailwind CSS + CSS Modules

### Spider (Python)
- **å¼‚æ­¥çˆ¬å–**: ä½¿ç”¨ asyncio æå‡æ€§èƒ½
- **é”™è¯¯é‡è¯•**: å†…ç½®é‡è¯•æœºåˆ¶å’Œå®¹é”™å¤„ç†
- **æ•°æ®ç®¡é“**: çˆ¬å– â†’ æ¸…æ´— â†’ å­˜å‚¨ â†’ Webhook é€šçŸ¥
- **ååçˆ¬**: åŠ¨æ€ User-Agent + è¯·æ±‚é—´éš”æ§åˆ¶

## ğŸ”§ Development Rules

### Naming Conventions
- **æ–‡ä»¶å**: `snake_case.py` (Python), `kebab-case.ts` (å·¥å…·), `PascalCase.tsx` (ç»„ä»¶)
- **å˜é‡/å‡½æ•°**: `snake_case` (Python), `camelCase` (TypeScript)
- **ç±»å**: `PascalCase` (æ‰€æœ‰è¯­è¨€)
- **å¸¸é‡**: `UPPER_SNAKE_CASE` (æ‰€æœ‰è¯­è¨€)
- **æ•°æ®åº“è¡¨**: `snake_case` å¤æ•°å½¢å¼ (å¦‚ `xhs_notes`)

### Import Organization
#### Python å¯¼å…¥é¡ºåº
1. `from __future__ import annotations`
2. æ ‡å‡†åº“å¯¼å…¥
3. ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
4. æœ¬åœ°æ¨¡å—å¯¼å…¥

#### TypeScript å¯¼å…¥é¡ºåº
1. React ç›¸å…³å¯¼å…¥
2. Next.js ç›¸å…³å¯¼å…¥
3. ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
4. æœ¬åœ°ç»„ä»¶å’Œå·¥å…·å¯¼å…¥
5. ç±»å‹å¯¼å…¥ (ä½¿ç”¨ `import type`)

### Error Handling
#### Backend
- ä¸šåŠ¡é€»è¾‘é”™è¯¯: `HTTPException(status_code=400, detail="message")`
- æƒé™é”™è¯¯: `HTTPException(status_code=403, detail="message")`
- èµ„æºä¸å­˜åœ¨: `HTTPException(status_code=404, detail="message")`
- æœåŠ¡å™¨é”™è¯¯: ç»Ÿä¸€åœ¨ middleware å¤„ç†

#### Frontend
- ä½¿ç”¨ try-catch åŒ…è£…å¼‚æ­¥æ“ä½œ
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- é”™è¯¯è¾¹ç•Œå¤„ç†ç»„ä»¶å´©æºƒ
- ç½‘ç»œé”™è¯¯é‡è¯•æœºåˆ¶

## ğŸ“ Documentation Standards

### MDC Components
å‚è€ƒ `mdc-examples/` ç›®å½•ä¸­çš„ç¤ºä¾‹ï¼š
- **API æ–‡æ¡£**: ä½¿ç”¨ `::api-endpoint` ç»„ä»¶
- **ç»„ä»¶æ¼”ç¤º**: ä½¿ç”¨ `::component-demo` ç»„ä»¶
- **å±æ€§è¡¨æ ¼**: ä½¿ç”¨ `::props-table` ç»„ä»¶
- **ä»£ç é«˜äº®**: ä½¿ç”¨ `::code-block` ç»„ä»¶
- **è­¦å‘Šæç¤º**: ä½¿ç”¨ `::alert` ç»„ä»¶

### API æ–‡æ¡£è§„èŒƒ
- æ¯ä¸ªç«¯ç‚¹å¿…é¡»åŒ…å«è¯·æ±‚/å“åº”ç¤ºä¾‹
- å‚æ•°è¯´æ˜å¿…é¡»å®Œæ•´
- é”™è¯¯çŠ¶æ€ç è¯´æ˜
- è®¤è¯è¦æ±‚è¯´æ˜

## ğŸ§ª Testing Standards

### Backend Tests
- ä½¿ç”¨ pytest-asyncio strict mode
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦ä¸šåŠ¡æµç¨‹
- Mock å¤–éƒ¨ä¾èµ–å’Œæ•°æ®åº“æ“ä½œ

### Frontend Tests
- Jest + React Testing Library
- ç»„ä»¶å•å…ƒæµ‹è¯•
- ç”¨æˆ·äº¤äº’æµ‹è¯•
- API é›†æˆæµ‹è¯•
- å¿«ç…§æµ‹è¯•ç”¨äº UI ä¸€è‡´æ€§

### Spider Tests
- æ•°æ®æŠ“å–å‡†ç¡®æ€§æµ‹è¯•
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶æµ‹è¯•
- ååçˆ¬æœºåˆ¶æµ‹è¯•
- æ•°æ®æ¸…æ´—å’Œæ ¼å¼åŒ–æµ‹è¯•

## ğŸš€ Performance & Security

### Database Optimization
- ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- åˆ†é¡µå¤„ç†å¤§æ•°æ®é›†
- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- è¿æ¥æ± ç®¡ç†

### Frontend Optimization
- Next.js Image ç»„ä»¶
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- React.memo å’Œ useMemo
- è™šæ‹Ÿæ»šåŠ¨å¤§åˆ—è¡¨

### Security Best Practices
- è¾“å…¥éªŒè¯å’Œ SQL æ³¨å…¥é˜²æŠ¤
- JWT token å®‰å…¨ç®¡ç†
- CORS å’Œ CSRF é˜²æŠ¤
- æ•æ„Ÿæ•°æ®åŠ å¯†

## ğŸ“Š Logging & Monitoring

### Logging Strategy
- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- è®°å½•å…³é”®ä¸šåŠ¡æ“ä½œ
- é”™è¯¯æ—¥å¿—åŒ…å«å †æ ˆä¿¡æ¯
- é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯

### Monitoring Points
- API å“åº”æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- çˆ¬è™«ä»»åŠ¡çŠ¶æ€
- ç³»ç»Ÿèµ„æºä½¿ç”¨

## ğŸ”„ Git Workflow

### Commit Message Format
```
<type>(<scope>): <description>

Types: feat, fix, docs, style, refactor, test, chore, perf
Scopes: backend, frontend, spider, docs, ci
```

### Branch Naming
- `feature/åŠŸèƒ½æè¿°`
- `bugfix/bugæè¿°`
- `hotfix/ç´§æ€¥ä¿®å¤`
- `docs/æ–‡æ¡£æ›´æ–°`

## ğŸ¯ Key Principles

1. **ç±»å‹å®‰å…¨ç¬¬ä¸€**: TypeScript strict mode + Pydantic ä¸¥æ ¼éªŒè¯
2. **æ€§èƒ½ä¼˜åŒ–**: å¼‚æ­¥ä¼˜å…ˆï¼Œåˆç†ç¼“å­˜ï¼Œé¿å… N+1 æŸ¥è¯¢
3. **ç”¨æˆ·ä½“éªŒ**: å“åº”å¼è®¾è®¡ï¼ŒåŠ è½½çŠ¶æ€ï¼Œé”™è¯¯å¤„ç†
4. **ä»£ç è´¨é‡**: å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œä»£ç å®¡æŸ¥ï¼Œè‡ªåŠ¨åŒ–æ£€æŸ¥
5. **å®‰å…¨æ„è¯†**: è¾“å…¥éªŒè¯ï¼Œæƒé™æ§åˆ¶ï¼Œæ•°æ®åŠ å¯†
6. **æ–‡æ¡£å®Œæ•´**: API æ–‡æ¡£ï¼Œç»„ä»¶æ–‡æ¡£ï¼Œæ¶æ„è¯´æ˜

## ğŸš€ Quick Start Commands

### Backend Development
```bash
cd fastapi_backend
make install      # å®‰è£…ä¾èµ–
make test         # è¿è¡Œæµ‹è¯•
make lint         # ä»£ç æ£€æŸ¥
make dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```

### Frontend Development
```bash
cd nextjs-frontend
pnpm install      # å®‰è£…ä¾èµ–
pnpm dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm test         # è¿è¡Œæµ‹è¯•
pnpm build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```

### Spider Operations
```bash
cd Spider_XHS
python main.py    # è¿è¡Œçˆ¬è™«
python -m pytest # è¿è¡Œæµ‹è¯•
```

> éµå¾ªä»¥ä¸Šè§„åˆ™ç¡®ä¿ä»£ç è´¨é‡ä¸å›¢é˜Ÿåä½œæ•ˆç‡ã€‚è¯¦ç»†ç¤ºä¾‹å‚è€ƒ `mdc-examples/` ç›®å½•ã€‚